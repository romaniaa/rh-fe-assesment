import{deepMerge,scrollLock}from"helpers";class WYATTElement extends HTMLElement{constructor(s){super(),this.config=this.getComponentConfig(s),this.unsubscribers=[]}disconnectedCallback(){this.unsubscribers.length&&this.unsubscribers.forEach((s=>s()))}getComponentConfig(s){const e=s||{},i=this.querySelector("[data-config]")?.textContent,t=i?JSON.parse(i):{},o=Math.random().toString(16).slice(2);return console.log("getCompConf"),deepMerge({id:o},e,t)}publish(s,e){WYATT.config.pubsub.subscribers[s]&&WYATT.config.pubsub.subscribers[s].forEach((s=>{s(e)}))}subscribe(s,e){void 0===WYATT.config.pubsub.subscribers[s]&&(WYATT.config.pubsub.subscribers[s]=[]),WYATT.config.pubsub.subscribers[s]=[...WYATT.config.pubsub.subscribers[s],e],this.unsubscribers.push((()=>{WYATT.config.pubsub.subscribers[s]=WYATT.config.pubsub.subscribers[s].filter((s=>s!==e))}))}}class WYATTDialog extends WYATTElement{constructor(){super(),this.openButton=this.querySelector("[data-open]"),this.dialog=this.getDialog(),this.wrapper=this.dialog.querySelector("[data-wrapper]"),this.openButton.addEventListener("click",this.open.bind(this)),this.handleClickOutside(),this.dialog.addEventListener("close",this.close.bind(this)),this.config.openOn&&this.config.openOn.forEach((s=>this.subscribe(WYATT.config.pubsub.events[s],this.open.bind(this)))),this.config.closeOn&&this.config.closeOn.forEach((s=>this.subscribe(WYATT.config.pubsub.events[s],this.close.bind(this))))}connectedCallback(){document.body.append(this.dialog)}disconnectedCallback(){super.disconnectedCallback(),this.dialog.remove()}open(){this.dialog.showModal(),this.dialog.setAttribute("active",!0),scrollLock.enable()}close(){this.dialog.close(),this.dialog.setAttribute("active",!1),scrollLock.disable()}handleClickOutside(){this.dialog.addEventListener("click",(()=>{this.dialog.close()})),this.wrapper.addEventListener("click",(s=>{s.stopPropagation()}))}getDialog(){return this.querySelector("[data-dialog]")||document.querySelector(this.openButton.dataset.open)}}export{WYATTElement,WYATTDialog};